generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  GESTION
}

enum Status {
  STOCK
  SOLD
  TOWITHDRAW
  WITHDRAWN
}

enum Types {
  DEPOSIT
  COMMISSION
  SALE
  PAY
}

models User {
  id                  String      @id @default(uuid())
  name                String
  surname             String
  email               String      @unique
  pwd_hash            String
  pwd_salt            String
  role                Role
}

model Session {
  id                  Int         @id @default(autoincrement())
  begin_date          DateTime    @default(now())
  end_date            DateTime
  commission          Int
  fees                Int
}

model Game {
  id                  Int         @id @default(autoincrement())
  name                String
  editor              String
}

model Client {
  id                  String      @id @default(uuid())
  name                String
  surname             String
  email               String      @unique
  phone_number        String      @unique
  address             String?

  @@index([email])
}

models Transaction {
  id                  Int         @id @default(autoincrement())
  date                DateTime    @default(now())
  value               Int
  Types               Types
  session             Session     @relation(fields: [session_id], references: [id])
  session_id          Int
  seller              Client      @relation(fields: [seller_id], references: [id])
  seller_id           String
  buyer               Client      @relation(fields: [buyer_id], references: [id])
  buyer_id            String?
}

model Realgame {
  id                  String      @id @default(uuid())
  unit_price          Int
  status              Status
  session             Session     @relation(fields: [session_id], references: [id])
  session_id          Int
  seller              Client      @relation(fields: [seller_id], references: [id])
  seller_id           String
  game                Game        @relation(fields: [game_id], references: [id])
  game_id             Int
  sale                Transaction @relation(fields: [transaction_id], references: [id])
  sale_id             Int?
}